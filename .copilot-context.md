# Copilot Context - POS Mini Modular

> **AI ASSISTANT QUICK START GUIDE**: Đọc file này FIRST khi start new conversation

## 🚀 **Project Summary**
**POS Mini Modular** - Vietnamese multi-tenant POS system với Next.js 15 + Supabase. Database prefix: `pos_mini_modular3_`

## ⚡ **Instant Context**
```typescript
// Current Status: Core development phase
✅ Authentication system (working perfectly)
✅ Dashboard with business analytics (optimized)  
✅ Database schema với 7 migrations (ready to apply)
🔄 POS selling module (in development)
🔄 Inventory management (planned)

// Tech Stack
Frontend: Next.js 15 + TypeScript strict + shadcn/ui
Backend: Supabase (PostgreSQL + Auth + RLS)
Patterns: Server components, session caching, business logging
```

## 🔑 **Critical Files to Understand**
1. **`lib/auth/auth-context.tsx`** - Main authentication system với session management
2. **`app/dashboard/page.tsx`** - Business dashboard với real-time analytics
3. **`MIGRATION_INSTRUCTIONS.md`** - Database deployment guide (SQL Editor only)
4. **`PROJECT_OVERVIEW.md`** - Complete technical documentation
5. **`supabase/migrations/`** - Database schema evolution (7 files, apply in order)

## 🎯 **Development Rules**
```typescript
// TypeScript Strict
❌ NO any types
✅ Use unknown, proper interfaces, generics

// React Components  
✅ export default function Component() { }              // Preferred
✅ import React; function Component(): JSX.Element { }  // Alternative

// Database Operations
✅ pos_mini_modular3_get_user_profile_safe()           // Use RPC functions
❌ Direct table queries                                 // Avoid

// Error Handling
✅ catch (error: unknown) { }                          // Always type
```

## 🔧 **Quick Start Commands**
```bash
# Development
npm run dev                    # Start development server
# OR use VS Code task: "test-optimized-system"

# Database (NO CLI - use Supabase SQL Editor)
Copy supabase/migrations/001_*.sql → Supabase Dashboard → SQL Editor → Run

# Testing
http://localhost:3000/test-enhanced-auth  # Test authentication flow
```

## 🐛 **Recent Important Fixes**
- **AuthProvider optimization**: Added initialSessionData prop để reuse server data
- **Performance improvement**: Dashboard load reduced from 1.5s to 900ms  
- **RPC consistency**: All auth functions use `pos_mini_modular3_get_user_profile_safe`
- **Documentation consolidation**: Comprehensive AI-friendly docs created

## 📊 **Current Architecture**
```
app/
├── layout.tsx              # AuthProvider wrapper
├── dashboard/              # Business analytics (working)
├── auth/login/             # Authentication (working)
lib/
├── auth/auth-context.tsx   # Session management (optimized)
├── logger/                 # Business logging system
supabase/
├── migrations/             # 7 files: 001-007 (apply in order)
```

## 🎯 **Next Development Tasks**
1. **POS Module**: Complete core selling functionality
2. **Inventory**: Stock tracking và management  
3. **Staff Management**: Role-based permissions
4. **Reports**: Advanced business analytics

## ⚠️ **Critical Don'ts**
- ❌ NO `npx supabase db push` (use SQL Editor only)
- ❌ NO any types (TypeScript strict mode)
- ❌ NO direct table access (use RPC functions)
- ❌ NO console.log in production (use business logger)

## 🔍 **Debugging Help**
- Authentication issues → Check `lib/auth/auth-context.tsx`
- Database issues → Use `pos_mini_modular3_` prefixed RPC functions
- Performance issues → Check business logger terminal output
- Build errors → Ensure TypeScript strict compliance

---

**AI Assistant**: Với context này, bạn có thể confidently continue development. Foundation đã rất solid, focus on building POS core features with established patterns.
